# 依赖构建
> 本章会继续围绕介绍页中的一个问题继续深入，找到的依赖模块如何构建？在这里我们统称为依赖构建。

上一章节讲到了依赖扫描，通过esbuildScanPlugin这个插件，深度遍历项目中所有的依赖，记录的 bare module 对象，就是依赖扫描的结果。有了这些结果就需要进行依赖的构建，在vite中对依赖预构建使用的是 Esbuild 工具。会将这些依赖单独打包放置在项目的 **`/node_modules/.vite/deps`** 里作为依赖缓存，在开发环境下引用的第三方依赖会重写至缓存地址，这样便实现了vite整个依赖预构建的过程。

那么，大家有没有思考过：**"vite每次启动该项目都会进行一次预构建吗？"**

## 依赖构建缓存
答案当然是否定的，因为在项目中使用的依赖基本都是第三方包安装进来的，基本不会在项目中直接去修改，并且依赖包中的代码一般也不会变动。如果vite每次启动项目又重新把所有依赖进行一次构建，在这其中会浪费非常多的时间无法达到妙级的速度。因此，需要设计一个缓存机制去记录每次依赖构建后模块的信息。根据这些记录的信息判断哪些模块是需要去重新构建的。

**在vite中会有了两个缓存机制：**
* 当启动项目的时候会同时启动 Dev Server 服务，对于依赖的请求结果，Vite会设置强缓存，缓存过期时间被设置为一年
* Vite 将构建后的产物信息记录在 /node_modules/.vite/deps/_metadata.json中，通过hash值对比判断是否需要重新构建

<ZoomImg src="../../../../public/images/scan/scan05.jpg" />

## 依赖构建过程